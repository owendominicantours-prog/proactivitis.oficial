generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model AgencyProfile {
  id          String @id
  userId      String @unique
  companyName String
  User        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Booking {
  id                  String           @id @default(cuid())
  tourId              String
  userId              String
  status              String          @default("CONFIRMED")
  source              String          @default("WEB")
  customerName        String
  customerEmail       String
  customerPhone       String?
  travelDate          DateTime        @map("date")
  paxAdults           Int             @default(1)
  paxChildren         Int             @default(0)
  passengers          Int?
  pickup              String?
  hotel               String?
  pickupNotes         String?
  totalAmount         Float
  stripeSessionId     String?          @map("stripe_session_id")
  stripePaymentIntentId String?         @map("stripe_payment_intent_id")
  stripeCheckoutUrl   String?          @map("stripe_checkout_url")
  paymentStatus       String?          @map("payment_status")
  supplierAmount      Float?
  platformFee         Float?
  agencyFee           Float?
  startTime           String?
  cancellationReason  String?
  cancellationByRole  String?
  cancellationAt      DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime?       @updatedAt
  User                User            @relation(fields: [userId], references: [id])
  Tour                Tour            @relation(fields: [tourId], references: [id])
  Conversation        Conversation?
}

model Conversation {
  id                      String                    @id
  type                    String                    @default("SUPPORT")
  reservationId           String?                   @unique
  createdById             String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  User                    User                      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  Booking                 Booking?                  @relation(fields: [reservationId], references: [id])
  ConversationParticipant ConversationParticipant[]
  Message                 Message[]
}

model ConversationParticipant {
  conversationId String
  userId         String
  role           String?      @default("MEMBER")
  User           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@id([conversationId, userId])
}

model LandingPage {
  id        String   @id
  slug      String   @unique
  title     String
  body      String
  updatedAt DateTime
}

model Message {
  id             String       @id
  conversationId String
  senderId       String
  senderRole     String
  content        String
  createdAt      DateTime     @default(now())
  User           User         @relation(fields: [senderId], references: [id], onDelete: Cascade)
  Conversation   Conversation @relation(fields: [conversationId], references: [id])
}

model Notification {
  id         String           @id
  type       String?
  role       String?
  title      String
  message    String?
  body       String?
  bookingId  String?
  metadata   String?
  caseNumber String?
  isRead     Boolean          @default(false) @map("read")
  createdAt  DateTime         @default(now())
}

model PartnerApplication {
  id           String   @id @default(cuid())
  role         String
  companyName  String
  contactName  String
  contactRole  String
  email        String
  phone        String
  country      String
  website      String?
  serviceTypes String
  description  String
  documentName String?
  documentUrl  String?
  status       String   @default("PENDING")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  userId       String?
  User         User?    @relation(fields: [userId], references: [id])
}

model Offer {
  id          String   @id
  tourId      String
  title       String
  description String
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  Tour        Tour     @relation(fields: [tourId], references: [id])
}

/// Fase 1: definición de países/destinos públicos para catálogo. Las relaciones y migraciones se aplicarán después.
model Country {
  id               String        @id @default(cuid())
  name             String
  slug             String        @unique
  code             String?
  shortDescription String?
  heroImage        String?
  destinations     Destination[]
}

model Destination {
  id               String        @id @default(cuid())
  name             String
  slug             String        @unique
  shortDescription String?
  heroImage        String?
  country          Country       @relation(fields: [countryId], references: [id])
  countryId        String
  tours            Tour[]
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SupplierProfile {
  id       String  @id
  userId   String  @unique
  company  String
  approved Boolean @default(false)
  User     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  Tour     Tour[]
}

model Tour {
  id              String          @id
  title           String
  slug            String          @unique
  productId       String          @unique @default(uuid())
  price           Float
  priceChild      Float?
  priceYouth      Float?
  duration        String
  description     String
  subtitle        String?
  shortDescription String?
  category        String?
  physicalLevel   String?
  minAge          Int?
  accessibility   String?
  confirmationType String?
  timeOptions     String?
  operatingDays   String?
  blackoutDates   String?
  capacity        Int?
  meetingPoint    String?
  meetingInstructions String?
  pickup          String?
  requirements    String?
  cancellationPolicy String?
  terms           String?
  language        String
  includes        String
  location        String
  supplierId      String
  featured        Boolean         @default(false)
  status          String          @default("draft")
  adminNote       String?
  createdAt       DateTime        @default(now())
  gallery         String?
  heroImage       String?
  departureDestinationId String?
  departureDestination   Destination?  @relation(fields: [departureDestinationId], references: [id])
  Booking         Booking[]
  Offer           Offer[]
  platformSharePercent Int            @default(20)
  SupplierProfile SupplierProfile @relation(fields: [supplierId], references: [id])
}

model User {
  id                      String                    @id
  name                    String?
  email                   String                    @unique
  password                String?
  role                    String                    @default("CUSTOMER")
  supplierApproved        Boolean                   @default(false)
  agencyApproved          Boolean                   @default(false)
  accountStatus           String                    @default("PENDING")
  statusMessage           String?
  rejectionAt             DateTime?
  createdAt               DateTime                  @default(now())
  Account                 Account[]
  AgencyProfile           AgencyProfile?
  Booking                 Booking[]
  Conversation            Conversation[]
  ConversationParticipant ConversationParticipant[]
  Message                 Message[]
  Session                 Session[]
  SupplierProfile         SupplierProfile?
  PartnerApplication      PartnerApplication[]
}
